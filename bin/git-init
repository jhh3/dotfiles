#!/bin/bash
# Creates a remote git repository from the current local directory.

# Configuration
# Defined in my .zshrc. Replace with desired to customize.
USER_HOST=$REMOTE_GIT_USER_HOST
GIT_PATH=$REMOTE_GIT_PATH

echo "----"
echo "-- Creating new Git repository."

REPO=${PWD##*/}
GIT_REMOTE_URL="$USER_HOST:$GIT_PATH/$REPO.git"

# Setup remote
echo "-- Creating remote repository at -> $USER_HOST:$GIT_PATH/$REPO"
echo "----"
echo ""

ssh $USER_HOST 'mkdir '$GIT_PATH'/'$REPO'.git && cd '$GIT_PATH'/'$REPO'.git && git --bare init'

# Setup local

echo ""
echo "----"
echo "Setting up local repository and pushing to remote"
echo "----"
echo ""

touch .gitignore
git init
git add .
git commit -m "initial commit"
git push --all $GIT_REMOTE_URL
git remote add origin $GIT_REMOTE_URL
git config branch.master.remote origin
git config branch.master.merge refs/heads/master
git fetch
git merge master
git branch -a
 
echo ""
echo "----"
echo "-- Your new git repo '$REPO' is ready and initialized at -> $USER_HOST:$GIT_PATH/$REPO.git"
echo "----"
